# å·¥ä½œæµåç§°
name: Auto Update Clash Config

# è§¦å‘æ¡ä»¶
on:
  # 1. å®šæ—¶è§¦å‘ï¼šä½¿ç”¨ cron è¯­æ³•ï¼Œè¿™é‡Œè®¾ç½®ä¸ºæ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡
  #    (0 */6 * * * è¡¨ç¤ºåœ¨æ¯6å°æ—¶çš„0åˆ†æ‰§è¡Œï¼Œä¾‹å¦‚ 0:00, 6:00, 12:00, 18:00 UTCæ—¶é—´)
  schedule:
    - cron: '0 */1 * * *'
  
  # 2. æ‰‹åŠ¨è§¦å‘ï¼šå…è®¸ä½ åœ¨ Actions é¡µé¢æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ
  workflow_dispatch:

# ä»»åŠ¡
jobs:
  build:
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest

    # ä»»åŠ¡æ­¥éª¤
    steps:
      # æ­¥éª¤1: æ£€å‡ºä»“åº“ä»£ç 
      # è¿™æ˜¯å¿…é¡»çš„ï¼Œè®©å·¥ä½œæµå¯ä»¥è®¿é—®ä½ çš„ä»“åº“æ–‡ä»¶
      - name: Checkout repository
        uses: actions/checkout@v4

      # æ­¥éª¤2: è®¾ç½® Python ç¯å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # ä½ å¯ä»¥é€‰æ‹© 3.8, 3.9, 3.10 ç­‰

      # æ­¥éª¤3: å®‰è£… Python ä¾èµ–åº“
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pyyaml

      # æ­¥éª¤4: è¿è¡Œä½ çš„ Python è„šæœ¬
      - name: Run the update script
        run: python update_clash.py

      # æ­¥éª¤5: å°†ç”Ÿæˆçš„æ–‡ä»¶æäº¤åˆ°ä»“åº“
      - name: Commit and push if changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # æäº¤ä¿¡æ¯
          commit_message: 'ğŸ‰ Auto-update Clash config'
          # è¦æäº¤çš„æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯ 1.yaml
          file_pattern: 1.yaml
